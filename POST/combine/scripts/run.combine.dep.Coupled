#! /bin/csh -f

# ====================== COMBINEv5.1 Run Script =====================
# Usage: run.combine.dep >&! combine_V51.dep.log &
#
# To report problems or request help with this script/program:
#             http://www.cmascenter.org
# ===================================================================

#> Source the config.cmaq file to set the run environment
 source ../../config.cmaq

#> Check that CMAQ_DATA is set: 
 if ( ! -e $CMAQ_DATA ) then
    echo "   $CMAQ_DATA path does not exist"
    exit 1
    endif
 echo " "; echo " Input data path, CMAQ_DATA set to $CMAQ_DATA"; echo " "

 set APPL = D51a
 set EXEC = COMBINE_${APPL}_$EXEC_ID

#> Set the working directory
 set BASE  = $cwd      
#set BASE  = $CMAQ_HOME/scripts/combine
 set BLD   = ${BASE}/BLD_$APPL

 cd $BASE; date; set timestamp; cat $BASE/cfg.${APPL}; echo " "; set echo

#> timestep run parameters

 set YEAR     = 2011
 set MONTH    = 07
 set MET_YEAR = 11

#> use GENSPEC switch to generate a new specdef file (does not generate output file)
 setenv GENSPEC N

#> define name of species definition file
 setenv SPECIES_DEF spec_def_files/species_dep_CMAQ5.1_cb05e51_ae6_aq_CAPS_Coupled.txt

# Needed julian day values by month (apply for leap year only)
if ( $MONTH == 01 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
else if ( $MONTH == 02 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28"
#set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29"
else if ( $MONTH == 03 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
else if ( $MONTH == 04 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30"
else if ( $MONTH == 05 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
else if ( $MONTH == 06 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30"
else if ( $MONTH == 07 ) then
#set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
 set days   = "01"
else if ( $MONTH == 08 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
else if ( $MONTH == 09 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30"
else if ( $MONTH == 10 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
else if ( $MONTH == 11 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30"
else if ( $MONTH == 12 ) then
 set days   = "01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
else
 echo " ========= MONTH MUST BE BETWEEN 1-12  =========="
 exit (1)
endif

## define name of output file 
 setenv OUTFILE CCTM_${APPL}_${EXEC_ID}_COMBINE_DEP.CMAQ51_TWOWAY_COUPLED-BENCHMARK_$YEAR$MONTH

 env

 ls -l $BLD/$EXEC

 foreach day ($days)

#> define name of input files
   setenv INFILE1 CCTM_DRYDEP.$YEAR$MONTH$day
   setenv INFILE2 CCTM_WETDEP1.$YEAR$MONTH$day
   setenv INFILE3 wrfout_d01_$Year-$MONTH-$day_00:00:00
 
#> Executable call:
   /usr/bin/time $BLD/$EXEC
 
 end

 date
 exit()
